{% init file = Storage(id = "0") %}
{% init show_create = True %}

{% if not show_create %}
    
{% elif file.id == "0" %}
    <!-- 跟节点 -->
    <a class="btn" href="javascript:createGroup();">新建项目</a>
{% else %}
    <div class="dropdown">
        <span class="dropdown-btn link btn">新建▾</span>
        <div class="dropdown-content">
            <a class="dropdown-option" href="javascript:createNote2();">笔记</a>
            <a class="dropdown-option" href="javascript:createGroup();">分组</a>
            <a class="dropdown-option" href="javascript:createDocument();">文档</a>
            <a class="dropdown-option" href="javascript:createGallery();">相册</a>
            <a class="dropdown-option" href="javascript:createList()();">清单</a>
            <a class="dropdown-option" href="javascript:uploadFile();">上传文件</a>
        </div>
    </div>
{% end %}

<script type="text/javascript">
/** 创建笔记基础 **/
function createNote0(title, type) {
    xnote.prompt(title, "", function (noteTitle) {
        var createOption = {};
        createOption.name = noteTitle;
        createOption.parent_id = "{{file.id}}";
        createOption.type = type;
        createOption._format = "json";
        $.post("/note/create", createOption, function (resp) {
            if (resp.code == "success") {
                window.location.href = resp.url;
            } else {
                alert(title + "失败:" + resp.message);
            }
        }).fail(function (e) {
            console.error(title + "失败", e);
            alert(title + "失败:" + e);
        });
    });
}
/** 新建笔记 **/
function createNote2() {
    window.location.href="/note/add";
}
/** 创建相册 **/
function createGallery() {
    createNote0("新建相册", "gallery");
}

/** 新建文档 **/
function createDocument() {
    createNote0("新建文档", "md");
}

/** 创建清单 **/
function createList() {
    createNote0("新建清单", "list");
}

/** 创建分组 **/
function createGroup() {
    var opName = "新建项目";
    xnote.prompt(opName, "", function (noteTitle) {
        var createOption = {};
        createOption.name = noteTitle;
        createOption.parent_id = "{{file.id}}";
        createOption.type = "group";
        createOption._format = "json";
        $.post("/note/create", createOption, function (resp) {
            if (resp.code == "success") {
                window.location.reload();
            } else {
                alert(opName + "失败:" + resp.message);
            }
        }).fail(function (e) {
            console.error(opName + "失败", e);
            alert(opName + "失败:" + e);
        });
    });
}

/** 上传文件 **/
function uploadFile() {
    window.location.href="/fs_upload";
}
</script>
